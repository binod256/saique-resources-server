{"version":3,"file":"client.js","sourceRoot":"","sources":["../../../../../src/ma-v2/client/client.ts"],"names":[],"mappings":"AAAA,OAAO,EACL,wBAAwB,EACxB,oBAAoB,GAIrB,MAAM,cAAc,CAAC;AACtB,OAAO,EAA8B,MAAM,MAAM,CAAC;AAElD,OAAO,EACL,sBAAsB,GAGvB,MAAM,gCAAgC,CAAC;AAExC,OAAO,EACL,+BAA+B,EAC/B,kBAAkB,GAInB,MAAM,oBAAoB,CAAC;AAyF5B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA8BG;AACH,MAAM,CAAC,KAAK,UAAU,4BAA4B,CAChD,MAG6C;IAE7C,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,CAAC;IAEpC,IAAI,OAAO,CAAC;IAEZ,IAAI,MAAM,CAAC,IAAI,KAAK,UAAU,EAAE,CAAC;QAC/B,OAAO,GAAG,MAAM,sBAAsB,CACpC,MAAyD,CAC1D,CAAC;IACJ,CAAC;SAAM,CAAC;QACN,OAAO,GAAG,MAAM,sBAAsB,CACpC,MAAsC,CACvC,CAAC;IACJ,CAAC;IAED,MAAM,kBAAkB,GAAG,MAAM,CAAC,KAAK,IAAI,EAAE;QAC3C,QAAQ,MAAM,CAAC,IAAI,EAAE,CAAC;YACpB,KAAK,UAAU;gBACb,OAAO;oBACL,YAAY,EAAE,oBAAoB,CAAC,MAAM,CAAC,YAAY,CAAC;iBACxD,CAAC;YACJ,KAAK,MAAM,CAAC;YACZ,KAAK,SAAS,CAAC;YACf,KAAK,SAAS;gBACZ,OAAO,EAAE,CAAC;YACZ;gBACE,OAAO,qBAAqB,CAAC,MAAM,CAAC,CAAC;QACzC,CAAC;IACH,CAAC,CAAC,EAAE,CAAC;IAEL,IAAI,kBAAkB,CAAC,SAAS,EAAE,KAAK,CAAC,EAAE,CAAC;QACzC,OAAO,+BAA+B,CAAC;YACrC,GAAG,MAAM;YACT,SAAS;YACT,KAAK;YACL,OAAO;YACP,GAAG,kBAAkB;SACtB,CAAC,CAAC;IACL,CAAC;IAED,OAAO,wBAAwB,CAAC;QAC9B,GAAG,MAAM;QACT,OAAO;QACP,GAAG,kBAAkB;KACtB,CAAC,CAAC;AACL,CAAC;AAED,SAAS,qBAAqB,CAAC,CAAQ;IACrC,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;AACrC,CAAC","sourcesContent":["import {\n  createSmartAccountClient,\n  webauthnGasEstimator,\n  type SmartAccountClient,\n  type SmartAccountClientConfig,\n  type SmartAccountSigner,\n} from \"@aa-sdk/core\";\nimport { type Chain, type Transport } from \"viem\";\n\nimport {\n  createModularAccountV2,\n  type CreateModularAccountV2Params,\n  type CreateWebauthnModularAccountV2Params,\n} from \"../account/modularAccountV2.js\";\n\nimport {\n  createAlchemySmartAccountClient,\n  isAlchemyTransport,\n  type AlchemySmartAccountClient,\n  type AlchemySmartAccountClientConfig,\n  type AlchemyTransport,\n} from \"@account-kit/infra\";\nimport type { LightAccount } from \"../../light-account/accounts/account.js\";\n\nimport type { ToWebAuthnAccountParameters } from \"viem/account-abstraction\";\nimport type {\n  ModularAccountV2,\n  WebauthnModularAccountV2,\n} from \"../account/common/modularAccountV2Base.js\";\n\nexport type ModularAccountV2Client<\n  TSigner extends SmartAccountSigner = SmartAccountSigner,\n  TChain extends Chain = Chain,\n  TTransport extends Transport | AlchemyTransport = Transport,\n> = TTransport extends AlchemyTransport\n  ? AlchemySmartAccountClient<TChain, ModularAccountV2<TSigner>>\n  : SmartAccountClient<TTransport, TChain, ModularAccountV2<TSigner>>;\n\nexport type WebauthnModularAccountV2Client<\n  TChain extends Chain = Chain,\n  TTransport extends Transport | AlchemyTransport = Transport,\n> = TTransport extends AlchemyTransport\n  ? AlchemySmartAccountClient<TChain, WebauthnModularAccountV2>\n  : SmartAccountClient<TTransport, TChain, WebauthnModularAccountV2>;\n\nexport type CreateModularAccountV2ClientParams<\n  TTransport extends Transport | AlchemyTransport = Transport,\n  TChain extends Chain = Chain,\n  TSigner extends SmartAccountSigner = SmartAccountSigner,\n> = CreateModularAccountV2Params<TTransport, TSigner> &\n  Omit<\n    TTransport extends AlchemyTransport\n      ? AlchemySmartAccountClientConfig<TChain>\n      : SmartAccountClientConfig<TTransport, TChain>,\n    \"transport\" | \"account\" | \"chain\"\n  >;\n\nexport type CreateWebauthnModularAccountV2ClientParams<\n  TTransport extends Transport | AlchemyTransport = Transport,\n  TChain extends Chain = Chain,\n> = CreateWebauthnModularAccountV2Params<TTransport> &\n  Omit<\n    TTransport extends AlchemyTransport\n      ? AlchemySmartAccountClientConfig<TChain>\n      : SmartAccountClientConfig<TTransport, TChain>,\n    \"transport\" | \"account\" | \"chain\"\n  > & {\n    credential: ToWebAuthnAccountParameters[\"credential\"];\n    getFn?: ToWebAuthnAccountParameters[\"getFn\"];\n    rpId?: ToWebAuthnAccountParameters[\"rpId\"];\n  };\n\nexport type CreateModularAccountV2AlchemyClientParams<\n  TTransport extends Transport = Transport,\n  TChain extends Chain = Chain,\n  TSigner extends SmartAccountSigner = SmartAccountSigner,\n> = Omit<\n  CreateModularAccountV2ClientParams<TTransport, TChain, TSigner>,\n  \"transport\"\n> &\n  Omit<\n    AlchemySmartAccountClientConfig<TChain, LightAccount<TSigner>>,\n    \"account\"\n  > & { paymasterAndData?: never; dummyPaymasterAndData?: never };\n\nexport function createModularAccountV2Client<\n  TChain extends Chain = Chain,\n  TSigner extends SmartAccountSigner = SmartAccountSigner,\n>(\n  args: CreateModularAccountV2AlchemyClientParams<\n    AlchemyTransport,\n    TChain,\n    TSigner\n  >,\n): Promise<ModularAccountV2Client<TSigner, TChain, AlchemyTransport>>;\n\nexport function createModularAccountV2Client<\n  TTransport extends Transport = Transport,\n  TChain extends Chain = Chain,\n  TSigner extends SmartAccountSigner = SmartAccountSigner,\n>(\n  args: CreateModularAccountV2ClientParams<TTransport, TChain, TSigner>,\n): Promise<ModularAccountV2Client<TSigner, TChain, TTransport>>;\n\nexport function createModularAccountV2Client<\n  TTransport extends Transport = Transport,\n  TChain extends Chain = Chain,\n>(\n  args: CreateWebauthnModularAccountV2ClientParams<TTransport, TChain>,\n): Promise<WebauthnModularAccountV2Client<TChain, TTransport>>;\n/**\n * Creates a Modular Account V2 client using the provided configuration parameters.\n *\n * @example\n * ```ts twoslash\n * import { createModularAccountV2Client } from \"@account-kit/smart-contracts\";\n * import { LocalAccountSigner } from \"@aa-sdk/core\";\n * import { alchemy, sepolia } from \"@account-kit/infra\";\n *\n * const MNEMONIC = \"...\";\n * const RPC_URL = \"...\";\n *\n * const signer = LocalAccountSigner.mnemonicToAccountSigner(MNEMONIC);\n *\n * const chain = sepolia;\n *\n * const transport = alchemy({ rpcUrl: RPC_URL });\n *\n * const policyId = \"...\";\n *\n * const modularAccountV2Client = await createModularAccountV2Client({\n *  chain,\n *  signer,\n *  transport,\n *  policyId, // NOTE: you may only pass in a gas policy ID if you provide an Alchemy transport!\n * });\n * ```\n *\n * @param {CreateModularAccountV2ClientParams} config The configuration parameters required to create the Modular Account v2 account client\n * @returns {Promise<SmartAccountClient>} A promise that resolves to a `SmartAccountClient` instance\n */\nexport async function createModularAccountV2Client(\n  config:\n    | CreateModularAccountV2ClientParams\n    | CreateWebauthnModularAccountV2ClientParams\n    | CreateModularAccountV2AlchemyClientParams,\n): Promise<SmartAccountClient | AlchemySmartAccountClient> {\n  const { transport, chain } = config;\n\n  let account;\n\n  if (config.mode === \"webauthn\") {\n    account = await createModularAccountV2(\n      config as CreateWebauthnModularAccountV2Params<Transport>,\n    );\n  } else {\n    account = await createModularAccountV2(\n      config as CreateModularAccountV2Params,\n    );\n  }\n\n  const middlewareToAppend = await (async () => {\n    switch (config.mode) {\n      case \"webauthn\":\n        return {\n          gasEstimator: webauthnGasEstimator(config.gasEstimator),\n        };\n      case \"7702\":\n      case \"default\":\n      case undefined:\n        return {};\n      default:\n        return assertNeverConfigMode(config);\n    }\n  })();\n\n  if (isAlchemyTransport(transport, chain)) {\n    return createAlchemySmartAccountClient({\n      ...config,\n      transport,\n      chain,\n      account,\n      ...middlewareToAppend,\n    });\n  }\n\n  return createSmartAccountClient({\n    ...config,\n    account,\n    ...middlewareToAppend,\n  });\n}\n\nfunction assertNeverConfigMode(_: never): never {\n  throw new Error(\"Unexpected mode\");\n}\n"]}